<UserControl
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            x:Class="zvs.WPF.ScheduledTaskControls.ScheduledTaskCreator"
            xmlns:converters="clr-namespace:zvs.WPF.Converters"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:dataModel="clr-namespace:zvs.DataModel;assembly=zvs.DataModel"
             xmlns:tasks="clr-namespace:zvs.DataModel.Tasks;assembly=zvs.DataModel"
             mc:Ignorable="d" 
             d:DesignHeight="934.025" d:DesignWidth="1037" Loaded="UserControl_Loaded_1" Unloaded="ScheduledTaskCreator_Unloaded_1" Initialized="UserControl_Initialized">
    <UserControl.Resources>
        <converters:NullableIntConverter x:Key="NullableIntConverter"/>

        <Style x:Key="BodyContentDataGridCentering"
        TargetType="{x:Type DataGridCell}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridCell}">
                        <Grid Background="{TemplateBinding Background}">
                            <ContentPresenter VerticalAlignment="Center" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="BodyHozCenter"
        TargetType="{x:Type DataGridCell}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridCell}">
                        <Grid Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <ObjectDataProvider x:Key="ScheduledTaskTypeEnum" MethodName="GetValues" ObjectType="{x:Type system:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="tasks:ScheduledTaskType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <CollectionViewSource x:Key="ScheduledTaskViewSource" d:DesignSource="{d:DesignInstance {x:Type dataModel:ZvsScheduledTask}, CreateList=True}"/>
    </UserControl.Resources>

    <Grid DataContext="{StaticResource ScheduledTaskViewSource}">
        <Border   VerticalAlignment="Top" Height="25" >
            <Border.Background>
                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                    <GradientStop Color="#FFF2F3F5" Offset="0.49"/>
                    <GradientStop Color="White" Offset="0.262"/>
                </LinearGradientBrush>
            </Border.Background>
            <TextBlock FontSize="14" FontWeight="Bold" TextWrapping="Wrap" Text="Scenes" VerticalAlignment="Center" Margin="5,0,0,0" />
        </Border>

        <DataGrid x:Name="ScheduledTaskDataGrid" Width="350" ItemsSource="{Binding}" AllowDrop="False"
                    HorizontalGridLinesBrush="#FFE2E2E2" AlternatingRowBackground="#FFFFFCFC" 
                  GridLinesVisibility="Horizontal"  HorizontalAlignment="Left" RowHeight="45" AutoGenerateColumns="False"  
                  CellStyle="{StaticResource BodyContentDataGridCentering}" SelectionMode="Single" 
                  PreviewKeyDown="ScheduledTaskDataGrid_PreviewKeyDown_1" RowEditEnding="ScheduledTaskDataGrid_RowEditEnding_1" 
                  SelectionChanged="ScheduledTaskDataGrid_SelectionChanged" Background="#FFF9F9F9" Margin="0,0,0,0" BorderThickness="0" >
            <DataGrid.Columns>

                <DataGridTemplateColumn MaxWidth="45" MinWidth="45" Width="45"  Header="" CanUserResize="False" CanUserReorder="False" CanUserSort="False">
                    <DataGridTemplateColumn.CellTemplate >
                        <DataTemplate>
                            <Image Name="img" Width="40" Height="40" Source="/zVirtualScenes;component/Images/scheduled_task.png" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Width="*" MinWidth="50" FontSize="16" Header="Scheduled Task" Binding="{Binding Path=Name, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="False"  CanUserReorder="False" CanUserSort="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridCheckBoxColumn Header="Enabled" MinWidth="55" Width="55"  CellStyle="{StaticResource BodyHozCenter}" 
                                        Binding="{Binding IsEnabled, UpdateSourceTrigger=PropertyChanged }" IsReadOnly="False" >
                </DataGridCheckBoxColumn>
            </DataGrid.Columns>
        </DataGrid>
        <Border Name="TaskDetails" BorderBrush="Gray" Margin="355,25,0,0" BorderThickness="0" Background="#FFFDFDFD" LostFocus="TaskUserControlGrid_OnLostFocus">
            <ScrollViewer HorizontalScrollBarVisibility="Auto">
                <Grid Margin="12" >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Vertical">
                        <TextBlock Name="TaskNameTxtBl" Text="{Binding Name, StringFormat={}{0} Details, FallbackValue=New Task}" FontWeight="Bold" FontSize="16" TextTrimming="CharacterEllipsis" ></TextBlock>
                        <TextBlock Text="Task Frequency" Margin="0 20 0 0"></TextBlock>
                        <ComboBox Name="FrequencyCmbBx" ItemsSource="{Binding Source={StaticResource ScheduledTaskTypeEnum}}"  Margin="5 5 0 0" HorizontalAlignment="Left" Width="176" SelectionChanged="FrequencyCmbBx_SelectionChanged"></ComboBox>

                        <TextBlock Text="Command to Run" Margin="0 20 0 0" />
                        <Button x:Name="AddUpdateCommand" HorizontalAlignment="Left" Content="Select Command" Margin="5 5 0 0" Width="116" Click="AddUpdateCommand_Click" />

                        <TextBlock FontSize="14" Margin="5 5 0 10" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" VerticalAlignment="Top" >
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} {1}"  >
                                    <Binding Path="Description" FallbackValue="Unknow" Mode="OneWay" UpdateSourceTrigger="PropertyChanged" />
                                    <Binding Path="TargetObjectName" FallbackValue="Unknown" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                    <Grid Grid.Row="1" Name="TaskUserControlGrid" LostFocus="TaskUserControlGrid_OnLostFocus" ></Grid>
                    <Image Grid.Row="2" Name="SignalImg" Source="../Images/send_signal.png" Height="15" Margin="10" VerticalAlignment="Bottom" HorizontalAlignment="Right" Opacity="0"></Image>

                </Grid>
            </ScrollViewer>
        </Border>

    </Grid>
</UserControl>
